{% extends 'core/base.html' %}
{% load bootstrap4 %}
{% load static %}
{% load crispy_forms_tags %}


{% block conteudo %}
<!-- Breadcrumbs-->
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{% url 'core:index'%}">Início</a>
        </li>
        <li class="breadcrumb-item ">
            <a href="{%url 'core:locacao-listar'%}">Locações</a>
        </li>
        <li class="breadcrumb-item active">Novo</li>
    </ol>

    {% bootstrap_messages %}

    <div class="container-fluid">
        <h2>Realizar Locação</h2>
        <hr>
        <form method="POST" class="form">
            {% csrf_token %}
            {% csrf_token %}
            {% bootstrap_form form %}

            <fieldset class="mt-4">
                <legend><b>Itens</b></legend>
                {{ formset.management_form }}
                <div class="table-responsive">
                    <table class="table">
                        <thead class="text-center">
                            <th scope="col">Filme</th>
                            <th scope="col">Data Prevista de Devolução</th>
                            <th scope="col">Valor</th>
                            <th scope="col"></th>
                        </thead>
                        <tbody>
                            {% for form in formset %}
                                <tr class="elenco-form {% if form.instance.pk %}item{% else %}new{% endif %} formset">
                                    <td>{{ form.id }} {{ form.item|as_crispy_field }}</td>
                                    <td>{{ form.data_devolucao_prevista|as_crispy_field }}</td>
                                    <td class="text-center">{{ form.valor|as_crispy_field }}</td>
                                    {% if form.istance.pk %}
                                        <td class="text-center">{{ form.DELETE }}</td>
                                    {% else %}
                                        <td class="text-center"></td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </fieldset>

            <hr>
            <a href="{%url 'core:locacao-listar'%}" class="btn btn-danger ml-2 mb-4 float-right">Cancelar</a>
            <button type="submit" class="btn btn-success ml-2 float-right">Realizar Locação</button>
        </form>
    </div>
{% endblock conteudo %}
{% block javascript %}
    <script>
        function atualizarDinamico(object){
    		
            var indice = object.closest("tr").rowIndex - 1;
            var data_prevista = $('#id_{{ formset.prefix}}-' + indice + '-data_devolucao_prevista').val();
            var preco = $('#id_{{ formset.prefix}}-' + indice + '-preco').val();
    
            console.log(quantidade);
            console.log(preco);
            console.log(object);
    
            console.log(parseFloat(quantidade) * parseFloat(preco));
    
            document.getElementById('total-'+ indice).innerHTML = parseFloat(quantidade) * parseFloat(preco); 
        }
    </script>
{% endblock javascript %}
